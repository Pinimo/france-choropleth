---
title: Articles
permalink: /
---

<div id="map"></div>

<script>
var map = L.map('map',{zoomAnimation:!/firefox/i.test(navigator.userAgent)})
           .setView([46.6, 2.1], 6)
           .addLayer(new L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',{
              subdomains: 'abcd',
              detectRetina: true,
              minZoom: 6, maxZoom: 12 })),
    d = {}, layer = [new L.layerGroup(),new L.layerGroup(),new L.layerGroup()];

function each(feature, layer){
  if(feature.properties.insee.length == 2){
    d[feature.properties.insee] = layer.getBounds();
  }
}

function draw(data, cl, l){
  if (data.type === "Topology"){
    for (key in data.objects){
      geojson = topojson.feature(data, data.objects[key]);
      l.addLayer(new L.GeoJSON(geojson,{className: cl, onEachFeature: each}))
    }
  }
}

d3.json("data/geo/topo/cantons.json", function(json){
  draw(json, "cantons", layer[1]);
  map.addLayer(layer[1]);
  d3.json("data/geo/topo/departements.json", function(json){
    draw(json, "departements", layer[0]);
    map.addLayer(layer[0]);
  });
});

map.on('moveend', function() {
  if(map.getZoom()<=6){
    map.addLayer(layer[0]);
  }
  if(map.getZoom()>6 && map.getZoom()<=8){
    map.removeLayer(layer[0]).addLayer(layer[1]).removeLayer(layer[2]);
  }
  if(map.getZoom()>8){
    map.removeLayer(layer[1]);
    for (i in d){
      bounds = map.getBounds();
      if (bounds.contains(d[i]) || bounds.intersects(d[i])){
        delete d[i];
        d3.json("data/geo/topo/"+i+".json", function(json){
          draw(json, "communes", layer[2]);
          map.addLayer(layer[2]);
        });
      }
      else{
        map.addLayer(layer[2]);
      }
    }
  }
});

</script>
