---
title: Articles
permalink: /
---

<div id="map"></div>

<script>

var map = L.map('map')
           .setView([46.6, 2.1], 6)
           .addLayer(new L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
              subdomains: 'abcd',
              detectRetina: true,
              minZoom: 6, maxZoom: 12 })),
    layers = {}, type ="";

function read(data, cl) {
  if (data.type === "Topology")
    for (key in data.objects) {
      geojson = topojson.feature(data, data.objects[key]); type = cl;
      new L.GeoJSON(geojson, {style: color, onEachFeature: store})
    }
}

function store(feature, json) {
  var el = new L.layerGroup();
  layers[type+feature.properties.insee] = [el,json.getBounds()];
  el.addLayer(json);
}

function color(feature) {
  return {
    fillColor: "#ccc",
    color: "#aaa",
    weight: 1,
    opacity: 1,
    fillOpacity: .8
  }
}

d3.json("data/geo/topo/cantons.json", function(json) {
  read(json, "can");
  d3.json("data/geo/topo/departements.json", function(json) {
    read(json, "dep");
    reset();
  });
});

function reset() {
  if(map.getZoom()<=6) {
    for (com in layers)
      if (com.substring(0,3) == "com") map.removeLayer(layers[com][0]); 
    for (can in layers)
      if (can.substring(0,3) == "can") map.addLayer(layers[can][0]); 
    for (dep in layers)
      if (dep.substring(0,3) == "dep") map.addLayer(layers[dep][0]); 
  }
  if(map.getZoom()>6 && map.getZoom()<=8) {
    for (com in layers)
      if (com.substring(0,3) == "com") map.removeLayer(layers[com][0]); 
    for (can in layers)
      if (can.substring(0,3) == "can") map.addLayer(layers[can][0]); 
    for (dep in layers)
      if (dep.substring(0,3) == "dep") map.removeLayer(layers[dep][0]); 
  }
  if(map.getZoom()>8)
    for (dep in layers)
      if (dep.substring(0,3) == "dep" &&
         (map.getBounds().contains(layers[dep][1]) || 
          map.getBounds().intersects(layers[dep][1]))) {
        (function(temp){
          d3.json("data/geo/topo/"+temp+".json", function(json) {
            read(json, "com");
            for (com in layers)
              if (com.substring(0,5) == "com"+temp)
                map.addLayer(layers[com][0]);
            for (can in layers)
              if (can.substring(0,6) == "can0"+temp)
                map.removeLayer(layers[can][0]);
            });
        })(dep.substring(3));
      }
}

map.on('moveend', reset);

</script>
