---
title: Articles
permalink: /
---

<div id="map"></div>

<script>
var map = L.map('map').setView([46.6, 2.1], 6)
           .addLayer(new L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',{
              subdomains: 'abcd',
              detectRetina: true,
              minZoom: 6, maxZoom: 12 })),
    d = {}, layer = [new L.layerGroup(),new L.layerGroup(),new L.layerGroup()];

function draw(data, cl, l){
  if (data.type === "Topology") {
    for (key in data.objects) {
      geojson = topojson.feature(data, data.objects[key]);
      l.addLayer(new L.GeoJSON(geojson,{className: cl,
        onEachFeature: function (feature, l) {
          if (cl === "departements"){
            d[feature.properties.insee] = l.getBounds();
          }
        }
      }))
    }
  }
}

d3.json("data/geo/topo/cantons.json", function(json){
  draw(json, "cantons", layer[1]);
  layer[1].addTo(map);
  d3.json("data/geo/topo/departements.json", function(json){
    draw(json, "departements", layer[0]);
    layer[0].addTo(map);
  });
});

map.on('moveend', function() {
  if(map.getZoom()>6 && map.getZoom()<=8){
    map.removeLayer(layer[0]).removeLayer(layer[2]).addLayer(layer[1]);
  }
  if(map.getZoom()<=6){
    map.addLayer(layer[0]);
  }
  if(map.getZoom()>8){
    map.removeLayer(layer[1]);
    for (i in d){
      bounds = map.getBounds();
      if (d[i] && (bounds.contains(d[i]) || bounds.intersects(d[i]))){
        d[i] = false ;
        d3.json("data/geo/topo/"+i+".json", function(json){
          draw(json, "communes", layer[2]);
          layer[2].addTo(map);
        });
      }
      else{
        layer[2].addTo(map);
      }
    }
  }
});

</script>
